<% content_for :navbar do %>
  <%= render 'layouts/dashboard_navbar' %>
<% end %>

<div class="settings">
  <div class="top-panel">
    <h2 class="settings-title">MY SETTINGS</h2>
  </div>
  <hr class="separator">
  <div class="left-panel">

      <div class="update-avatar thumbnail" onclick="document.getElementById('upload-photo-input').click();">
        <%= image_tag(profile_pic_link, size: "200x200", class: "rounded-circle") %>
        <div id="upload-photo-div" class="overlay rounded-circle">
          <div class="overlayText">
            Upload Photo
          </div>
        </div>

    </div>
    <div class="upload-photo modal" id="pic-input-dialog" tabindex="-1" role="dialog">
      <div class="upload-photo modal-dialog modal-dialog-centered" role="document">
        <div class="upload-photo modal-content">
          <div class="upload-photo modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="upload-photo modal-body">
            <div id="upload-croppie">
              <span id="minus">-</span>
              <span id="plus">+</span>
            </div>
          </div>
          <div class="upload-photo modal-footer">
            <button type="button" class="btn btn-primary" onclick="updatePicture();">Upload</button>
          </div>
        </div>
      </div>
    </div>

    <h2 class="user-name"><%= @user.name %></h2>

  </div>

  <div class="right-panel">
    <h2 class="heading">Personal</h2>
    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
      <%= devise_error_messages! %>

      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
      <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
      <% end %>

      <div class="update-avatar">
        <div class="upload-wrap">
          <%= f.file_field :profile_pic, id: "upload-photo-input", class: "upload-btn", onchange: "$('#pic-input-dialog').modal('show');", accept: "image/*", direct_upload: true%>
        </div>
      </div>

      <div class="field">
        <%= f.label 'Update email' %><br />
        <%= f.email_field :email, autofocus: true, autocomplete: "email", class: "inputField", placeholder: "email@example.com" %>
      </div>


      <div class="field">
        <%= f.label 'Update password' %><br>
        <%= f.password_field :password, autocomplete: "new-password", placeholder: "New password", class: "inputField"%><br>
        <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "inputField", placeholder: "Confirm new password"%>
      </div>

      <div class="field">
        <%= f.label "Update state/country" %><br>
        <%= f.select :state, options_for_select(us_states, resource.state), {:include_blank => "State"}, {:class => "inputField"} %> <br>
        <%= f.select :country, options_for_select(countries, resource.country), {:include_blank => "Country"}, {:class => "inputField", :onchange => "updateStateField();"}%>
      </div>

      <div class="field">
        <%= f.label "Update local time zone" %> <br>
        <%= f.select :timezone, time_zone_options_for_select(get_timezone_name_from(resource.timezone)), {:include_blank=> "Time zone"}, {:class=> "inputField"}%>
      </div>

      <div class="actions">
        <%= f.submit "SAVE", class: "btn save-button" %>
      </div>
    <% end %>
  </div>
  <hr class="separator">
  <div class="spacer"></div>
  <div class="notifications">
    <h2 class="heading">Notifications</h2>
    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, id: "edit-notifications" }) do |f| %>
      <%= devise_error_messages! %>

      <div class="field">
        <%= f.label 'How often would you like to be reminded of your challenges via email?' %><br />
        <%= f.select :notifications, options_for_select(notifications, resource.notifications), {:include_blank => ""}, {:class=> "inputField"} %>
      </div>

      <div class="actions">
        <%= f.submit "SAVE", class: "btn save-button" %>
      </div>
    <% end %>
  </div>
</div>
